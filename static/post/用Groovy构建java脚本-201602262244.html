<!doctype html><head><meta charset="utf-8"><style>.mydoc{font-size:14px;overflow:hidden}.mydoc_blockquote{padding:12px 5px 12px 30px;margin:2em 0 0 8px;border-width:0;border-left:4px solid #f66;background-color:#f8f8f8;position:relative;border-bottom-right-radius:2px;border-top-right-radius:2px;line-height:1.6em}.mydoc_blockquote:before{position:absolute;top:14px;left:-12px;background-color:#f66;color:#fff;content:"!";width:20px;height:20px;text-align:center;line-height:20px;font-weight:700;font-family:Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:14px;border-radius:10px}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.mydoc_code{overflow-x:auto;position:relative;background-color:#f8f8f8;padding:0;line-height:1.1em;border-radius:2px;margin:1.2em 0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AgMAAABHkjHhAAAACVBMVEWAgIBaWlo+Pj7rTFvWAAAAA3RSTlMHCAw+VhR4AAAA+klEQVQoz4WSMW7EQAhFPxKWNh2FCx+HkaZI6RRb5DYbyVfIJXLKDCFoMbaTKSw/8ZnPAPjaH2xgZcUNUDADD7D9LtDBCLZ45fbkvo/30K8yeI64pPwl6znd/3n/Oe93P3ho9qeh72btTFzqkz0rsJle8Zr81OLEwZ1dv/713uWqvu2pl+k0fy7MWtj9r/tN5q/02z89qa/L4Dc2LvM93kezPfXlME/O86EbY/V9GB9ePX8G1/6W+/9h1dq/HGfTfzT3j/xNo7522Bfnqe5jO/fvhVthlfk434v3iO9zG/UOphyPeinPl1J8Gtaa7xPTa/Dk+RIs4deMvwGvcGsmsCvJ0AAAAABJRU5ErkJggg==")}.mydoc_code_pre{padding:1.2em 1.4em;line-height:1.5em;margin:0}.mydoc_h1{margin:0 0 1em}.mydoc_h1_a{color:#2c3e50;text-decoration:none;font-size:2em}.mydoc_h1_h1{margin:45px 0 8px;padding-bottom:7px;font-size:28px}.mydoc_h2{margin:35px 0 .8em}.mydoc_h2_a{font-size:1.5em;text-decoration:none;color:#2c3e50}.mydoc_h2_a:before{content:"";display:block;margin-top:-40px;height:40px;visibility:hidden}.mydoc_h2_h2{margin:5px 0 8px;border-bottom:1px solid #ddd;font-size:22px;padding-bottom:1em}.mydoc_h3{margin:35px 0 .8em}.mydoc_h3_a{font-size:1.3em;text-decoration:none;color:#2c3e50}.mydoc_h3_a:before{content:"";display:block;margin-top:-30px;height:30px;visibility:hidden}.mydoc_h3_h3{margin:5px 0 8px;border-bottom:1px solid #ddd;font-size:18px;padding-bottom:.6em}.mydoc_h4{margin:35px 0 .8em}.mydoc_h4_a{font-size:1.2em;text-decoration:none;color:#2c3e50}.mydoc_h4_a:before{content:"";display:block;margin-top:-20px;height:20px;visibility:hidden}.mydoc_h4_h4{margin:5px 0 8px;border-bottom:1px solid #ddd;font-size:16px;padding-bottom:.3em}.mydoc_table{margin:15px 0 0;padding:0;border:1px solid #aaa;border-collapse:collapse;width:100%;color:#000;font-size:14px;background-color:#fdfcf8}.mydoc_table .mydoc_tr{margin:0;padding:0;border:0;background-color:#fff}.mydoc_table .mydoc_tr:nth-child(odd){background-color:#f5f5f5}.mydoc_table .mydoc_th,.mydoc_table .mydoc_tr:first-child{background-color:#3f3f3f}.mydoc_table .mydoc_th{margin:0;padding:5px 15px 5px 6px;border:1px solid #3f3f3f;vertical-align:baseline;text-align:left;color:#fff;width:123px;word-break:break-all;font-weight:400}.mydoc_table .mydoc_td{word-break:break-all;margin:0;padding:6px 15px 6px 6px;border:1px solid #aaa;vertical-align:text-top}.mydoc_img{display:block;max-width:100%}.mydoc_li:first-child,:not(.mydoc_li)+.mydoc_li{margin-top:10px}.mydoc_li+.mydoc_li{margin-top:-10px}.mydoc_li{margin:0;color:#34495e;margin-bottom:10px;position:relative}.mydoc_p{line-height:1.6em;margin:1.2em 0 -1.2em;padding-bottom:1.2em;position:relative;z-index:1;color:#333}.mydoc_a{color:#42b983;font-weight:400;text-decoration:none;cursor:pointer}.mydoc_strong{font-weight:600;color:#2c3e50}</style></head><article class='mydoc'>
                    <div class="mydoc_h1">
                <a class="mydoc_h1_a">
                    <h1 class="mydoc_h1_h1">用Groovy构建java脚本</h1>
                </a>
                <div class="mydoc_h1_content">
                    <p class="mydoc_p"> 我是做工作流项目的，工作流中各个模板引擎都需要要执行一个动态业务，这些动态业务有多种实现方式，最常用的就是用户自己写一段脚本文件，然后工作流引擎执行到这里的时候，运行这个脚本文件。</p><p class="mydoc_p"> 这个运行脚本文件的功能最初项目组是用ScriptEngineManager实现的。要求用户提供一个实现业务的jar，并写js脚本，脚本里动态地调用java内置在js引擎里的几个函数，这几个函数就是动态地调用jar里面的业务函数。</p><p class="mydoc_p"> 但是这样做太不方便，一是js无法调用java代码，只能预置java函数，或者通过预置的java函数反射其他业务函数。同时js语法对于java程序员也太晦涩了，作为java程序员，很多对js语法不够了解，甚至是误解的。</p><p class="mydoc_p"> 于是js这个方式我们就弃用了，现在准备使用Groovy这门语言来做脚本。</p><p class="mydoc_p"> Groovy相信java开发人员都听说过，毕竟是java的兄弟语言，他和java一样都是基于jvm这个中间件的语言，关系可以类比c#.net和vb.net。和Groovy相同的基于jvm的语言也有很多，这里就不展开了。</p><p class="mydoc_p"> 那么使用Groovy有什么好处呢？</p><p class="mydoc_p"> 1.首先需求是要求使用动态脚本语言，调用java写的类库，因此语言最好是动态的，这样可以写得更少的代码，对于脚本也有来说代码长度至关重要。Groovy就是这样一个动态语言，有闭包以及其他动态语言中的特性。这些特性我不是特别看重，主要是他的集合对象调用非常简单，[]可以视为list对象，{}可以视为map对象，同时是弱类型的，你不需要像使用java一样在类型转换上花很多时间。这些对于脚本语言来说太重要了。毕竟脚本语言只是组织和调用java写的业务，自己不做业务，所以不需要太好的可维护性，但是需要足够灵活能够简单高效地调用业务函数。</p><p class="mydoc_p"> 2.Groovy几乎支持java的所有语法，你可以把他直接当做java来用，这样对于java工程师而言无疑是福音，如果你拒绝使用Groovy的动态特性，你完全可以只写java代码，完全把他当java来用。</p><p class="mydoc_p"> 3.Groovy能直接调用java现有的类，也就是说你可以直接使用某个jar提供的类库，这一点对于我们来说太重要了，直接new业务函数类，就可以调用jar里面的业务接口了。</p><p class="mydoc_p"> 为了测试Groovy是否能完成以上需求，我做了一个测试demo。</p><p class="mydoc_p"> 首先定义一个java类，充当业务jar。</p><figure class='mydoc_code'>
                    <pre class="mydoc_code_pre cm-s-eclipse"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaFunction</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> String <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"运行了java代码"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre>
                </figure><p class="mydoc_p"> 然后直接GroovyShell测试脚本</p><figure class='mydoc_code'>
                    <pre class="mydoc_code_pre cm-s-eclipse"><span class="token keyword">import</span> groovy<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Binding<span class="token punctuation">;</span>
<span class="token keyword">import</span> groovy<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>GroovyShell<span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroovyScriptEngineTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{</span>
        Binding binding <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Binding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span><span class="token string">"javaFunction"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JavaFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        GroovyShell gs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GroovyShell</span><span class="token punctuation">(</span>binding<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Object value <span class="token operator">=</span> gs<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>
            <span class="token comment">//可以引入java类</span>
            <span class="token string">"import com.zrsoft.groovyScriptEngineTest.JavaFunction;"</span>
            <span class="token operator">+</span> <span class="token string">"println 'Groovy可以直接import当前classpath里的类！';"</span>
            <span class="token comment">//可以写Groovy语法的代码。Groovy是动态语言，比java适合写脚本</span>
            <span class="token operator">+</span> <span class="token string">"println '运行了Groovy代码！';"</span>
            <span class="token comment">//可以使用java风格的Groovy，其实就是java代码，因为Groovy支持java</span>
            <span class="token operator">+</span> <span class="token string">"String javaCode = "</span>运行了Java风格的Groovy代码！<span class="token string">";"</span>
            <span class="token operator">+</span> <span class="token string">"System.out.println(javaCode);"</span>
            <span class="token comment">//可以直接创建java自定义的对象</span>
            <span class="token operator">+</span> <span class="token string">"JavaFunction newJavaFunction = new JavaFunction();"</span>
            <span class="token operator">+</span> <span class="token string">"println "</span>在Groovy引擎里创建java对象，并<span class="token string">" + newJavaFunction.run();"</span>
            <span class="token comment">//可以调用脚本预设的java对象</span>
            <span class="token operator">+</span> <span class="token string">"return javaFunction.run();"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"为GroovyShell预设java对象，并在Groovy里"</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">"，同时证明Groovy可以返回变量给java。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre>
                </figure><p class="mydoc_p"> 以上测试全部通过</p><figure class='mydoc_code'>
                    <pre class="mydoc_code_pre cm-s-eclipse">Groovy可以直接<span class="token keyword">import</span>当前classpath里的类！
运行了Groovy代码！
运行了Java风格的Groovy代码！
在Groovy引擎里创建java对象，并运行了java代码
为GroovyShell预设java对象，并在Groovy里运行了java代码，同时证明Groovy可以返回变量给java。</pre>
                </figure><p class="mydoc_p"> 当然以上测试完成，还不足以让我们确定使用Groovy做脚本方案可行，运行性能和运行后内存释放情况还需进一步考察。</p>
                </div>
            </div>
                </article>